{% extends "base.html" %}

{% block title %}Админ панель – ключи API{% endblock %}

{% block content %}
<div class="card">
    <h1>Ключи API</h1>
    <p class="muted">Создание и просмотр API ключей</p>
</div>
<div class="card">
    <h2>Создать новый премиум-ключ</h2>
    <form method="post" action="/keys/create">
        <label>Название клиента</label>
        <input name="name" required placeholder="Например: Браузерное расширение" />
        <label>Описание (необязательно)</label>
        <input name="description" placeholder="Краткое описание" />
        <input type="hidden" name="access_level" value="premium" />
        <div class="muted">Уровень доступа: <b>premium</b></div>
        <label>Срок действия (дней)</label>
        <select name="expires_days">
            <option value="7">7</option>
            <option value="30" selected>30</option>
            <option value="90">90</option>
            <option value="365">365</option>
        </select>
        <label>Дневной лимит</label>
        <input name="daily_limit" type="number" min="1" value="10000" />
        <label>Почасовой лимит</label>
        <input name="hourly_limit" type="number" min="1" value="10000" />
        <button type="submit">Создать ключ</button>
    </form>
</div>
<div class="card">
    <h2>Продлить ключ</h2>
    <form method="post" action="/keys/extend">
        <label>API ключ</label>
        <input name="api_key" required placeholder="PREMI*-*****-..." />
        <label>Продлить на (дней)</label>
        <select name="extend_days">
            <option value="7">7</option>
            <option value="30" selected>30</option>
            <option value="90">90</option>
            <option value="365">365</option>
        </select>
        <button type="submit">Продлить</button>
    </form>
</div>
<div class="card">
    <h2>Список ключей</h2>
    <div style="overflow:auto">
        <table>
            <thead>
                <tr>
                    <th>Ключ</th><th>Имя</th><th>Активен</th><th>Уровень</th><th>Username</th>
                    <th>Email</th><th>Пароль</th><th>Лимиты (день/час)</th>
                    <th>Запросы (сегодня/час)</th><th>Всего</th><th>Последнее использование</th>
                    <th>Истекает</th><th>Осталось</th>
                </tr>
            </thead>
            <tbody>
                {% if keys %}
                    {% for k in keys %}
                    <tr>
                        <td><code>{{ k.api_key }}</code></td>
                        <td>{{ k.name }}</td>
                        <td>{{ 'да' if k.is_active else 'нет' }}</td>
                        <td><span class="badge-{{ k.get('access_level', 'basic') }}">{{ k.get('access_level', 'basic') }}</span></td>
                        <td>{{ k.username if k.username else '<span style="color: #059669;">Свободен</span>' | safe }}</td>
                        <td>{{ k.email or '-' }}</td>
                        <td>{{ '***' if k.password_hash else '-' }}</td>
                        <td>{{ k.rate_limit_daily }}/{{ k.rate_limit_hourly }}</td>
                        <td>{{ k.requests_today }}/{{ k.requests_hour }}</td>
                        <td>{{ k.requests_total }}</td>
                        <td class="muted">{{ k.last_used }}</td>
                        <td class="muted">{{ k.expires_at or '-' }}</td>
                        <td><span style="color: #059669; font-weight: 500;">{{ format_time_remaining(k.expires_at) }}</span></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr><td colspan="13" class="muted">Ключей пока нет</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

